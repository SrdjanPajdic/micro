!function(t,e){function n(e){this.props=e,this.id=this.utils.getUniqueId(),this.defaultTile=t.document.title,this.events=new n.Pubsub(this.id);var i=new n.Router(this.props.router,this.events),o=new n.Tpl(this.props.config,this.events);this.setAnimationDuration(),this.setListeners(),this.initEventsLogic(i,o),i.invoke();var r=this;return{id:r.id,page:i.path.bind(i),load:o.loadTpl.bind(o),render:o.replaceHtml.bind(o),compile:o.parseTpl.bind(o),setAnimation:function(t){o.props.enterAnimation=t},getPage:function(t){var e=Object.keys(t)[0];return r.props.router.filter(function(n){return n[e]==t[e]})[0]}}}n.prototype={isMicro:!0,eventsAdded:!1,initEventsLogic:function(e,n){if(!this.eventsAdded){var i=this;i.events.on("routeChange",e.path.bind(e)),i.events.on("routeMatch",n.loadTpl.bind(n));var o=function(t,e,n){var o=t.page;o.on&&"function"==typeof o.on[n]&&o.on[n](o,e);var r=i.props.config;r.on&&"function"==typeof r.on[n]&&r.on[n](t,e)};i.events.on("beforerender",function(e,n){var r=e.page.title;t.document.title=r?r:i.defaultTile,o(e,n,"beforerender")}),i.events.on("render",function(t,e){o(t,e,"render"),i.setListeners(t)}),t.addEventListener&&t.addEventListener("popstate",e.invoke.bind(e)),i.eventsAdded=!0}},microLinkClick:function(e){var e=t.e||e,n=e.target;if("A"==n.tagName&&(e.preventDefault(),n.hasAttribute("micro-link")))return this.events.fire("routeChange",n.getAttribute("micro-link")),!1},setListeners:function(t){var n=this;setTimeout(function(){Array.prototype.slice.call(e.querySelectorAll("[micro-link]")).forEach(function(e){if(t){var i=n.props.config.linkActiveCls||"micro-link-active",o=t.page.match==e.getAttribute("micro-link");e.classList.toggle(i,o)}(!e.microId||e.microId&&e.microId.length&&e.microId.indexOf(n.id)<0)&&(e.microId||(e.microId=[]),e.addEventListener?e.addEventListener("click",function(t){n.microLinkClick(t)},!1):e.attachEvent("onclick",function(t){n.microLinkClick(t)}),e.microId.push(n.id))})},0)},setAnimationDuration:function(){var t=this.props.config.animationDuration;if(this.props.config.enterAnimation&&this.props.config.animationDuration){var n=e.createElement("style");n.type="text/css",n.appendChild(e.createTextNode(".animated{animation-duration: "+t+"s !important; -webkit-animation-duration: "+t+"s !important; }")),e.head.appendChild(n)}},utils:function(){function t(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t))+t}function e(t){var e,n,i;for(i=t.length;i;i--)e=Math.floor(Math.random()*i),n=t[i-1],t[i-1]=t[e],t[e]=n;return t.join("")}var n=this;return n.getUniqueId=function(){return e(((new Date).getTime().toString()+t(1,1e4).toString()).split("")).trim()},n}()},"undefined"!=typeof module&&module.exports?module.exports=n:"function"==typeof define&&define.amd?define(function(){return n}):t.Micro=n}(window,document),function(){function t(t){this.id=t;var e={},n=e.hasOwnProperty;return{on:function(t,i){n.call(e,t)||(e[t]=[]);var o=e[t].push(i)-1;return{remove:function(){delete e[t][o]}}},fire:function(t,i){n.call(e,t)&&e[t].forEach(function(t){t(void 0!=i?i:{})})}}}"function"==typeof Micro&&Micro.prototype.isMicro&&(Micro.Pubsub=t)}(),function(t,e){function n(t,e){this.routes=t,this.events=e}n.prototype={invoke:function(){var t=this;return this.routes&&this.routes.forEach(function(e){t.doesMatch(e)&&t.events.fire("routeMatch",e)}),t},doesMatch:function(e){var n=t.location.pathname,i=!1;if(!e.match)return this.log(e.route+" rule has no callback"),i;var o=e.match.split("/");o.shift();var r=n.split("/");if(r.shift(),n==e.match&&(i=!0),o.length==r.length)for(var a=0;a<o.length;a++)0==o[a].search(":")&&(i=!0);return i},path:function(e){t.location.pathname!=e&&history.pushState({page:(new Date).getTime()},"",e),this.invoke()},log:function(t){console.log(t)}},"function"==typeof Micro&&Micro.prototype.isMicro&&(Micro.Router=n)}(window,document),function(t,e){function n(t,e){this.props=t,this.events=e,this.props.enterAnimation&&""!=this.props.enterAnimation&&this.embedAnimations()}n.prototype={tplCache:{},loadTpl:function(t){var e=this;this.activeRoute=t,e.events.fire("beforerender",{page:this.activeRoute}),Array.isArray(t.tpl)?t.tpl.forEach(function(t){e.loadFile(t)}):e.loadFile(t)},loadFile:function(t){var n=this;n.activeTpl=t;var i=e.querySelector(n.getContainerSelector(t));if(i.className="",i.style.opacity=0,n.isRouteCached(t))return void n.render(n.tplCache[t.src],t);tplFile=n.props.tplDir+"/"+t.src;var o=new XMLHttpRequest;o.addEventListener("load",function(){(n.props.cache||t.cache)&&n.cacheRoute(t,o.responseText),n.render(o.responseText,t)}),o.open("GET",tplFile,!0),o.send()},getContainerSelector:function(t){return t.container||this.props.container},isRouteCached:function(t){return this.tplCache&&this.tplCache.hasOwnProperty(t.src)},cacheRoute:function(t,e){this.tplCache[t.tpl]=e},render:function(t,e){var n=this,i=this.activeRoute.data||this.props.data||{},o=this.parseTpl(t,i);this.replaceHtml(o,n.getContainerSelector(e)),setTimeout(function(){n.events.fire("render",{page:n.activeRoute})},0),this.animate(e)},replaceHtml:function(t,n){e.querySelector(n).innerHTML=t},parseTpl:function(t,e){return t.replace(RegExp("{{\\s*([a-z0-9_][.a-z0-9_]*)\\s*}}","gi"),function(t,n){for(var i=n.split("."),o=i.length,r=e,a=0;a<o;a++)r=r[i[a]]||"";return r})},animate:function(t){var n=this;setTimeout(function(){var i=t.enterAnimation||n.props.enterAnimation;i&&(e.querySelector(n.getContainerSelector(t)).className="animated "+i)},0)},log:function(t){console.log(t)},embedAnimations:function(){var t="microAnimationLibrary";if(!e.getElementById("microAnimationLibrary")){var n=e.createElement("link");n.href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css",n.rel="stylesheet",n.id=t,e.head.appendChild(n)}}},"function"==typeof Micro&&Micro.prototype.isMicro&&(Micro.Tpl=n)}(window,document);